<!doctype html><html lang=en dir=auto data-theme=dark><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>The Non-(White) Noise Generator | _techguy</title><meta name=keywords content="javascript,web-dev,app"><meta name=description content="The Problem
Anyone who is a parent knows that all those &ldquo;humming bears&rdquo; and shushing toys can be a lifesaver when facing the task of putting a child to sleep. The physical shushing mascot is becoming a bit of a thing of the past these days. Firstly, it’s not necessarily the favorite plushie your little one wants to sleep with, and secondly, there are limitations you have to deal with in that situation. I used to use an app, the name of which I can’t even remember anymore. As long as it worked, I didn&rsquo;t touch it. But&mldr; an unnecessary Android phone suddenly changed its status to &ldquo;needed,&rdquo; and its place was taken by an old iPhone 6 running on iOS 12."><meta name=author content="B"><link rel=canonical href=https://bgracz.github.io/posts/white-noise-generator/><link crossorigin=anonymous href=/assets/css/stylesheet.11c11881f5e0d39ef83c3725410857a554d16f60d621bb0f91522c64ce5c7f0a.css integrity="sha256-EcEYgfXg0574PDclQQhXpVTRb2DWIbsPkVIsZM5cfwo=" rel="preload stylesheet" as=style><link rel=icon href=https://bgracz.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://bgracz.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://bgracz.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://bgracz.github.io/apple-touch-icon.png><link rel=mask-icon href=https://bgracz.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://bgracz.github.io/posts/white-noise-generator/><noscript><style>#theme-toggle,.top-link{display:none}</style></noscript><meta property="og:url" content="https://bgracz.github.io/posts/white-noise-generator/"><meta property="og:site_name" content="_techguy"><meta property="og:title" content="The Non-(White) Noise Generator"><meta property="og:description" content="The Problem Anyone who is a parent knows that all those “humming bears” and shushing toys can be a lifesaver when facing the task of putting a child to sleep. The physical shushing mascot is becoming a bit of a thing of the past these days. Firstly, it’s not necessarily the favorite plushie your little one wants to sleep with, and secondly, there are limitations you have to deal with in that situation. I used to use an app, the name of which I can’t even remember anymore. As long as it worked, I didn’t touch it. But… an unnecessary Android phone suddenly changed its status to “needed,” and its place was taken by an old iPhone 6 running on iOS 12."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2026-02-18T12:53:52+01:00"><meta property="article:modified_time" content="2026-02-18T12:53:52+01:00"><meta property="article:tag" content="Javascript"><meta property="article:tag" content="Web-Dev"><meta property="article:tag" content="App"><meta property="og:image" content="https://bgracz.github.io/posts/white-noise-generator/cover.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bgracz.github.io/posts/white-noise-generator/cover.png"><meta name=twitter:title content="The Non-(White) Noise Generator"><meta name=twitter:description content="The Problem
Anyone who is a parent knows that all those &ldquo;humming bears&rdquo; and shushing toys can be a lifesaver when facing the task of putting a child to sleep. The physical shushing mascot is becoming a bit of a thing of the past these days. Firstly, it’s not necessarily the favorite plushie your little one wants to sleep with, and secondly, there are limitations you have to deal with in that situation. I used to use an app, the name of which I can’t even remember anymore. As long as it worked, I didn&rsquo;t touch it. But&mldr; an unnecessary Android phone suddenly changed its status to &ldquo;needed,&rdquo; and its place was taken by an old iPhone 6 running on iOS 12."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://bgracz.github.io/posts/"},{"@type":"ListItem","position":2,"name":"The Non-(White) Noise Generator","item":"https://bgracz.github.io/posts/white-noise-generator/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"The Non-(White) Noise Generator","name":"The Non-(White) Noise Generator","description":"The Problem Anyone who is a parent knows that all those \u0026ldquo;humming bears\u0026rdquo; and shushing toys can be a lifesaver when facing the task of putting a child to sleep. The physical shushing mascot is becoming a bit of a thing of the past these days. Firstly, it’s not necessarily the favorite plushie your little one wants to sleep with, and secondly, there are limitations you have to deal with in that situation. I used to use an app, the name of which I can’t even remember anymore. As long as it worked, I didn\u0026rsquo;t touch it. But\u0026hellip; an unnecessary Android phone suddenly changed its status to \u0026ldquo;needed,\u0026rdquo; and its place was taken by an old iPhone 6 running on iOS 12.\n","keywords":["javascript","web-dev","app"],"articleBody":"The Problem Anyone who is a parent knows that all those “humming bears” and shushing toys can be a lifesaver when facing the task of putting a child to sleep. The physical shushing mascot is becoming a bit of a thing of the past these days. Firstly, it’s not necessarily the favorite plushie your little one wants to sleep with, and secondly, there are limitations you have to deal with in that situation. I used to use an app, the name of which I can’t even remember anymore. As long as it worked, I didn’t touch it. But… an unnecessary Android phone suddenly changed its status to “needed,” and its place was taken by an old iPhone 6 running on iOS 12.\nNothing is quite as surprising as the lack of a free and sensible alternative for this type of app in the AppStore. Never mind a symbolic dollar or two. But a subscription model for several dollars a month?! There is one more factor contributing to this problem: the SDK version.\nAspect iOS 12 SDK (Xcode 10) iOS 26 SDK (Xcode 26) Base Version iOS 12.0 (2018) iOS 26.0 (2025) Deployment Target iOS 12.0 and up iOS 12.0+ (build with Xcode 26+) New Frameworks ARKit 2, GroupFaceTime SwiftUI 6+, Apple Intelligence, VisionKit Deprecated API - UIWebView, NSURLConnection App Store Reqs Outdated since 2026 Mandatory from April 2026 Supported Devices iPhone 5s+ iPhone 12+ (AI features) Key APIs (13+) Unavailable (Sign in, Dark Mode) Available via @available checks So, let’s summarize my needs:\nThe app must work on iOS 12. We don’t want a subscription; a symbolic, one-time fee is acceptable. The app must be ad-free—we don’t want to wake the heir with a lady waving a Revolut card around. A programmable timer with a smooth fade-out. The ability to choose sound characteristics—I learned about this need a bit later, but we’ll get to that. Let’s write the app ourselves! However, I don’t have an Apple Developer account. I’ve had one on Google Play for ages. I don’t have anything with Android on hand—infinite loop. But here comes an iOS feature that we almost lost due to absurd EU regulations—PWA.\nProgressive Web App (PWA) is a web application that combines the advantages of websites with the functionality of native apps. It runs in the browser (HTML, CSS, JavaScript) but installs like an app on the home screen. Service Workers enable offline work and fast loading via caching. Push notifications, access to camera/GPS, and an icon right next to native apps.\nAnd the best part is that PWAs are available from iOS 11.3 upwards!\nGUI You can see the result right now in the screenshot below. The assumptions were simple—dark mode, because the app is mainly intended for use after dark, and simplicity. No unnecessary selection from dozens of sounds or mixing them together. No settings menu whatsoever—just one screen containing what is needed.\nFinally, I even display the time remaining until the noise stops in MM:SS format, even if I have 176:33. It doesn’t bother me. I won’t fix it anymore—if it works, there’s no point in touching it.\nIt is worth remembering the appropriate tags in the head:\n1 2 3 4 5 6 7 \u003chead\u003e \u003cmeta charset=\"UTF-8\"\u003e \u003cmeta name=\"viewport\" content=\"width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no\"\u003e \u003cmeta name=\"apple-mobile-web-app-capable\" content=\"yes\"\u003e \u003cmeta name=\"apple-mobile-web-app-status-bar-style\" content=\"black-translucent\"\u003e \u003clink rel=\"apple-touch-icon\" href=\"icon.png\"\u003e \u003c/head\u003e Backend And here is where much more is happening. First challenge—iOS cannot kill JavaScript after the screen goes dark. Neither immediately, nor after an hour or longer. Browsers drastically limit resources for inactive tabs. Classic setInterval can start to “lag,” making the on-screen timer unreliable.\nWe solve this in two ways:\nAudio plays on: The Web Audio API runs on a separate thread, so the sound won’t be interrupted. Timestamps: Instead of counting seconds, we save the end time (Date.now() + duration). Every time we return to the tab (visibilitychange), we refresh the UI based on the current system time. 1 2 3 4 5 document.addEventListener(\"visibilitychange\", () =\u003e { if (!document.hidden \u0026\u0026 globalEndTime \u003e 0) { refreshTimerUI(); } }); Math The most interesting element is generating the noise itself. Initially, I wanted to spend a few moments looking for a high-quality few-second loop of white noise. But sound is just pure mathematics. Especially something as simple as randomly occurring values.\nWhite noise is a set of randomly generated values ranging from -1 to 1. This range represents two states of the speaker membrane—maximally retracted and maximally extended. Everyone has surely had the opportunity to observe membrane movement, especially visible during a heavy bass hit (which is often accompanied by a strong blast of air).\nBefore we generate our array, we must define the buffer size. I decided to reserve space in the RAM for 2 seconds of sound. This is the optimal value between wastefulness and tricking the brain so it doesn’t catch a repeating sound pattern.\n1 const bufferSize = 2 * audioCtx.sampleRate; 2 * 44100 = 88,200 Hz That’s exactly how many samples we will generate when the sound starts, save them in RAM, and then play them in a loop.\nLet’s proceed to generate the samples. We’ll do this in the simplest loop, which will repeat until we fill the entire array of our buffer with values.\n1 2 3 for (let i = 0; i \u003c bufferSize; i++) { data[i] = Math.random() * 2 - 1; } Math.random() itself provides values from the range 0.0 - 1.0. We expand this range twofold by multiplying Math.random() x 2, which gives an array of random values with a range of 0.0 - 2.0. In the last step, we step back by 1: Math.random() * 2 - 1, and we have a set of values ranging from -1.0 to 1.0 :)\nYou might not realize what we achieved here, so let’s stop for a moment to summarize. The moment the user clicks START, the iPhone processor generates 88,200 random values, which takes about 2-3 ms, and saves them in RAM.\n88,200 samples x 4 bytes (Web Audio API standard) is merely 344.5 KB of data!\nIf, instead of a 2-second loop that we play over and over, we generated data on the fly, an hour of synthesizing such noise would lead to generating approx. 600 MB of data. That’s almost as much as a CD.\nWhite noise, however, isn’t quite what I expected. The sound is not very pleasant due to the excessive randomness of consecutive generated samples. The solution is…\nBrown noise, which differs from white noise in that it applies a random walk instead of full randomness. Brown noise remembers the previous sample. Therefore, it has an influence on the next one, which in turn influences the next… and so on until the end. The jumps are much smaller, which makes the synthesized sound more pleasant.\n1 2 3 4 5 6 let lastOut = 0.0; for (let i = 0; i \u003c bufferSize; i++) { let white = Math.random() * 2 - 1; lastOut = (lastOut + (0.02 * white)) / 1.02; data[i] = lastOut * 3.5; } After initializing the lastOut variable, during each iteration, we assign the value of the expression lastOut + (0.02 * white) / 1.02. In short, we add only a small fragment of the new one to the previously generated sample. White noise simply substitutes a whole new value.\nWhat else? I won’t hide that the biggest challenge was preventing the app from sleeping, while the aspects of mathematical sound generation are interesting enough to me that they pushed me to write this article. The app wouldn’t be complete without details. After all, while the sound is playing, we might want to increase its duration because the baby is waking up. The sound should start smoothly and fade out just as smoothly so as not to wake our sleepyhead. This, in turn, can lead to a collision if the fade-out time and volume ramp-up time overlap. This is already simple mathematics with dynamic calculation of current variable values. It’s something to think about, but nothing to debate.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 function scheduleAudioFade(durationSec, startTime) { let fadeDuration = Math.min(durationSec, 180); let fadeStart = startTime + (durationSec - fadeDuration); const fadeInEndTime = startTime + 4; if (fadeStart \u003c fadeInEndTime) { fadeStart = fadeInEndTime; fadeDuration = (startTime + durationSec) - fadeStart; } if (fadeDuration \u003e 0) { gainNode.gain.setValueAtTime(1, fadeStart); gainNode.gain.linearRampToValueAtTime(0.0001, fadeStart + fadeDuration); } } Summary iOS 12 is, on one hand, a stumbling block—old APIs, outdated requirements—but on the other hand, Apple was less restrictive back then, which turned out to be somewhat of a salvation. The solution, although tailor-made and unsupported by newer devices, fulfills its purpose. Stability was wildly important, and that was also achieved. Additionally, the adventure with mathematical sound generation provided a large dose of knowledge and exploration of a new area. A fascinating area, because who knows what other programming experiments could be performed during future home projects?\n","wordCount":"1498","inLanguage":"en","image":"https://bgracz.github.io/posts/white-noise-generator/cover.png","datePublished":"2026-02-18T12:53:52+01:00","dateModified":"2026-02-18T12:53:52+01:00","author":{"@type":"Person","name":"B"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://bgracz.github.io/posts/white-noise-generator/"},"publisher":{"@type":"Organization","name":"_techguy","logo":{"@type":"ImageObject","url":"https://bgracz.github.io/favicon.ico"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://bgracz.github.io/ accesskey=h title="_techguy (Alt + H)">_techguy</a><div class=logo-switches></div></div><ul id=menu><li><a href=https://bgracz.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://bgracz.github.io/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://bgracz.github.io/about/ title="About me"><span>About me</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">The Non-(White) Noise Generator</h1><div class=post-meta><span title='2026-02-18 12:53:52 +0100 +0100'>February 18, 2026</span>&nbsp;·&nbsp;<span>8 min</span>&nbsp;·&nbsp;<span>B</span></div></header><figure class=entry-cover><img loading=eager srcset='https://bgracz.github.io/posts/white-noise-generator/cover_hu_82c6b20dbc3a49b8.png 360w,https://bgracz.github.io/posts/white-noise-generator/cover_hu_61d0320e3c66a717.png 480w,https://bgracz.github.io/posts/white-noise-generator/cover_hu_8c55fd1588e5ed7d.png 720w,https://bgracz.github.io/posts/white-noise-generator/cover.png 1024w' src=https://bgracz.github.io/posts/white-noise-generator/cover.png sizes="(min-width: 768px) 720px, 100vw" width=1024 height=559 alt="The Non-(White) Noise Generator"></figure><div class=post-content><h2 id=the-problem>The Problem<a hidden class=anchor aria-hidden=true href=#the-problem>#</a></h2><p>Anyone who is a parent knows that all those &ldquo;humming bears&rdquo; and shushing toys can be a lifesaver when facing the task of putting a child to sleep. The physical shushing mascot is becoming a bit of a thing of the past these days. Firstly, it’s not necessarily the favorite plushie your little one wants to sleep with, and secondly, there are limitations you have to deal with in that situation. I used to use an app, the name of which I can’t even remember anymore. As long as it worked, I didn&rsquo;t touch it. But&mldr; an unnecessary <strong>Android</strong> phone suddenly changed its status to &ldquo;needed,&rdquo; and its place was taken by an old <strong>iPhone 6</strong> running on <strong>iOS 12</strong>.</p><p>Nothing is quite as surprising as the lack of a <strong>free and sensible</strong> alternative for this type of app in the AppStore. Never mind a symbolic dollar or two. But a subscription model for <strong>several</strong> dollars a month?!
There is one more factor contributing to this problem: the SDK version.</p><table><thead><tr><th>Aspect</th><th>iOS 12 SDK (Xcode 10)</th><th>iOS 26 SDK (Xcode 26)</th></tr></thead><tbody><tr><td>Base Version</td><td>iOS 12.0 (2018)</td><td>iOS 26.0 (2025)</td></tr><tr><td>Deployment Target</td><td>iOS 12.0 and up</td><td>iOS 12.0+ (build with Xcode 26+)</td></tr><tr><td>New Frameworks</td><td>ARKit 2, GroupFaceTime</td><td>SwiftUI 6+, Apple Intelligence, VisionKit</td></tr><tr><td>Deprecated API</td><td>-</td><td>UIWebView, NSURLConnection</td></tr><tr><td>App Store Reqs</td><td>Outdated since 2026</td><td>Mandatory from April 2026</td></tr><tr><td>Supported Devices</td><td>iPhone 5s+</td><td>iPhone 12+ (AI features)</td></tr><tr><td>Key APIs (13+)</td><td>Unavailable (Sign in, Dark Mode)</td><td>Available via @available checks</td></tr></tbody></table><p><strong>So, let&rsquo;s summarize my needs:</strong></p><ol><li>The app must work on iOS 12.</li><li>We don&rsquo;t want a subscription; a symbolic, one-time fee is acceptable.</li><li>The app must be ad-free—we don&rsquo;t want to wake the heir with a lady waving a Revolut card around.</li><li>A programmable timer with a smooth fade-out.</li><li>The ability to choose sound characteristics—I learned about this need a bit later, but we&rsquo;ll get to that.</li></ol><h2 id=lets-write-the-app-ourselves>Let&rsquo;s write the app ourselves!<a hidden class=anchor aria-hidden=true href=#lets-write-the-app-ourselves>#</a></h2><p>However, I don&rsquo;t have an Apple Developer account. I&rsquo;ve had one on Google Play for ages. I don&rsquo;t have anything with Android on hand—infinite loop.
But here comes an iOS feature that we almost lost due to absurd EU regulations—<strong>PWA</strong>.</p><blockquote><p><strong>Progressive Web App (PWA)</strong> is a web application that combines the advantages of websites with the functionality of native apps. It runs in the browser (HTML, CSS, JavaScript) but installs like an app on the home screen. Service Workers enable offline work and fast loading via caching. Push notifications, access to camera/GPS, and an icon right next to native apps.</p></blockquote><p>And the best part is that PWAs are available from iOS 11.3 upwards!</p><h3 id=gui>GUI<a hidden class=anchor aria-hidden=true href=#gui>#</a></h3><p>You can see the result right now in the screenshot below. The assumptions were simple—dark mode, because the app is mainly intended for use after dark, and simplicity. No unnecessary selection from dozens of sounds or mixing them together. No settings menu whatsoever—just one screen containing what is needed.</p><p><div style="text-align:center;margin:1em 0"><img src=/posts/white-noise-generator/maingui.png#center#50 alt="GUI screen" style=width:50%;height:auto;border-radius:8px;display:inline-block></div></p><p>Finally, I even display the time remaining until the noise stops in MM:SS format, even if I have 176:33. It doesn&rsquo;t bother me. I won&rsquo;t fix it anymore—if it works, there&rsquo;s no point in touching it.</p><p>It is worth remembering the appropriate tags in the <em>head</em>:</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">7
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>charset</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;UTF-8&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;viewport&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;apple-mobile-web-app-capable&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;yes&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>meta</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;apple-mobile-web-app-status-bar-style&#34;</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;black-translucent&#34;</span>&gt;
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;apple-touch-icon&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;icon.png&#34;</span>&gt;
</span></span><span style=display:flex><span>&lt;/<span style=color:#f92672>head</span>&gt;
</span></span></code></pre></td></tr></table></div></div><h3 id=backend>Backend<a hidden class=anchor aria-hidden=true href=#backend>#</a></h3><p>And here is where much more is happening. First challenge—iOS cannot kill JavaScript after the screen goes dark. Neither immediately, nor after an hour or longer.
Browsers drastically limit resources for inactive tabs. Classic <code>setInterval</code> can start to &ldquo;lag,&rdquo; making the on-screen timer unreliable.</p><p>We solve this in two ways:</p><ul><li>Audio plays on: The Web Audio API runs on a separate thread, so the sound won&rsquo;t be interrupted.</li><li>Timestamps: Instead of counting seconds, we save the end time (<code>Date.now() + duration</code>). Every time we return to the tab (<code>visibilitychange</code>), we refresh the UI based on the current system time.</li></ul><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ts data-lang=ts><span style=display:flex><span>document.<span style=color:#a6e22e>addEventListener</span>(<span style=color:#e6db74>&#34;visibilitychange&#34;</span>, () <span style=color:#f92672>=&gt;</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#f92672>!</span>document.<span style=color:#a6e22e>hidden</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>globalEndTime</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>refreshTimerUI</span>();
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>});
</span></span></code></pre></td></tr></table></div></div><h3 id=math>Math<a hidden class=anchor aria-hidden=true href=#math>#</a></h3><p>The most interesting element is generating the noise itself. Initially, I wanted to spend a few moments looking for a high-quality few-second loop of white noise. But sound is just pure mathematics. Especially something as simple as randomly occurring values.</p><p><strong>White noise</strong> is a set of randomly generated values ranging from -1 to 1. This range represents two states of the speaker membrane—maximally retracted and maximally extended. Everyone has surely had the opportunity to observe membrane movement, especially visible during a heavy bass hit (which is often accompanied by a strong blast of air).</p><p>Before we generate our array, we must define the buffer size. I decided to <em>reserve</em> space in the RAM for 2 seconds of sound. This is the optimal value between wastefulness and tricking the brain so it doesn&rsquo;t catch a repeating sound pattern.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>bufferSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>audioCtx</span>.<span style=color:#a6e22e>sampleRate</span>;
</span></span></code></pre></td></tr></table></div></div><p>2 * 44100 = 88,200 Hz
That’s exactly how many samples we will generate when the sound starts, save them in RAM, and then play them in a loop.</p><p>Let&rsquo;s proceed to generate the samples. We&rsquo;ll do this in the simplest loop, which will repeat until we fill the entire array of our buffer with values.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>bufferSize</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p><code>Math.random()</code> itself provides values from the range 0.0 - 1.0. We expand this range twofold by multiplying <code>Math.random()</code> <strong>x 2</strong>, which gives an array of random values with a range of 0.0 - 2.0. In the last step, we step back by 1: <code>Math.random() * 2</code> <strong>- 1</strong>, and we have a set of values ranging from -1.0 to 1.0 :)</p><p><strong>You might not realize what we achieved here, so let&rsquo;s stop for a moment to summarize. The moment the user clicks <em>START</em>, the iPhone processor generates 88,200 random values, which takes about 2-3 ms, and saves them in RAM.</strong></p><p><strong>88,200 samples x 4 bytes (Web Audio API standard) is merely 344.5 KB of data!</strong></p><p>If, instead of a 2-second loop that we play over and over, we generated data on the fly, an hour of synthesizing such noise would lead to generating approx. <strong>600 MB</strong> of data. That&rsquo;s almost as much as a CD.</p><p>White noise, however, isn&rsquo;t quite what I expected. The sound is not very pleasant due to the excessive randomness of consecutive generated samples. The solution is&mldr;</p><p><strong>Brown noise</strong>, which differs from white noise in that it applies a <em>random walk</em> instead of full randomness.
Brown noise <em>remembers</em> the previous sample. Therefore, it has an influence on the next one, which in turn influences the next&mldr; and so on until the end. The jumps are much smaller, which makes the synthesized sound more pleasant.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">6
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>let</span> <span style=color:#a6e22e>lastOut</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.0</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>let</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>bufferSize</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>white</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>random</span>() <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>lastOut</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>lastOut</span> <span style=color:#f92672>+</span> (<span style=color:#ae81ff>0.02</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>white</span>)) <span style=color:#f92672>/</span> <span style=color:#ae81ff>1.02</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>=</span> <span style=color:#a6e22e>lastOut</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>3.5</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><p>After initializing the <em>lastOut</em> variable, during each iteration, we assign the value of the expression <em>lastOut + (0.02 * white) / 1.02</em>.
In short, we add only a small fragment of the new one to the previously generated sample. White noise simply substitutes a whole new value.</p><h3 id=what-else>What else?<a hidden class=anchor aria-hidden=true href=#what-else>#</a></h3><p>I won&rsquo;t hide that the biggest challenge was preventing the app from sleeping, while the aspects of mathematical sound generation are interesting enough to me that they pushed me to write this article.
The app wouldn&rsquo;t be complete without details. After all, while the sound is playing, we might want to increase its duration because the baby is waking up. The sound should start smoothly and fade out just as smoothly so as not to wake our sleepyhead. This, in turn, can lead to a <em>collision</em> if the fade-out time and volume ramp-up time overlap.
This is already simple mathematics with dynamic calculation of current variable values. It&rsquo;s something to think about, but nothing to debate.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-ts data-lang=ts><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>scheduleAudioFade</span>(<span style=color:#a6e22e>durationSec</span>, <span style=color:#a6e22e>startTime</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fadeDuration</span> <span style=color:#f92672>=</span> Math.<span style=color:#a6e22e>min</span>(<span style=color:#a6e22e>durationSec</span>, <span style=color:#ae81ff>180</span>);
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>fadeStart</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>startTime</span> <span style=color:#f92672>+</span> (<span style=color:#a6e22e>durationSec</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>fadeDuration</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>fadeInEndTime</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>startTime</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fadeStart</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>fadeInEndTime</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fadeStart</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>fadeInEndTime</span>; 
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fadeDuration</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>startTime</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>durationSec</span>) <span style=color:#f92672>-</span> <span style=color:#a6e22e>fadeStart</span>;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>fadeDuration</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>gainNode</span>.<span style=color:#a6e22e>gain</span>.<span style=color:#a6e22e>setValueAtTime</span>(<span style=color:#ae81ff>1</span>, <span style=color:#a6e22e>fadeStart</span>);
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>gainNode</span>.<span style=color:#a6e22e>gain</span>.<span style=color:#a6e22e>linearRampToValueAtTime</span>(<span style=color:#ae81ff>0.0001</span>, <span style=color:#a6e22e>fadeStart</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>fadeDuration</span>);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></td></tr></table></div></div><h2 id=summary>Summary<a hidden class=anchor aria-hidden=true href=#summary>#</a></h2><p>iOS 12 is, on one hand, a stumbling block—old APIs, outdated requirements—but on the other hand, Apple was less restrictive back then, which turned out to be somewhat of a salvation.
The solution, although tailor-made and unsupported by newer devices, fulfills its purpose. Stability was wildly important, and that was also achieved. Additionally, the adventure with mathematical sound generation provided a large dose of knowledge and exploration of a new area. A fascinating area, because who knows what other programming experiments could be performed during future home projects?</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://bgracz.github.io/tags/javascript/>Javascript</a></li><li><a href=https://bgracz.github.io/tags/web-dev/>Web-Dev</a></li><li><a href=https://bgracz.github.io/tags/app/>App</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://bgracz.github.io/>_techguy</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script></body></html>